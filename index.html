<!DOCTYPE html>
<!--?xml version="1.0"?-->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:svg="http://www.w3.org/2000/svg">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!--meta name="viewport" content="width=device-width, height=device-height, initial-scale = 0.5, maximum-scale = 0.5" /-->
    <meta name="viewport" content="initial-scale = 0.4, maximum-scale = 0.4, minimum-scale = 0.4, user-scalable=no" />
    <title>e-fun</title>
        <style media="screen">
        html, body
        {
            overflow: hidden;
            height: 100%;
            width: 100%;
            margin-top: 0px;
            margin-left: 0px;
            touch-action: none;
            pointer-events: auto;
            background-color: gray;
        }
        .center {
            position: absolute;
            top: 50%;
            width: 100%;
            text-align: center;
        }
        
        a, a.exHover:visited, a.exHover:link {cursor: pointer; background-color: white; color: gray; text-decoration:none; border-radius: 100px; border:0px solid #4466DD;}
        a.exHover:hover {cursor: pointer; background-color: lightgray; color:gray; text-decoration:none; border-radius: 100px; border:0px solid #6699FF;}
        a.exHover:active {cursor: pointer; background-color: lightgray; color:gray; text-decoration:none; border-radius: 100px; border:0px solid #DDDDFF;}

        a, img {
          -webkit-user-select: none; /* Safari 3.1+ */
          -moz-user-select: none; /* Firefox 2+ */
          -ms-user-select: none; /* IE 10+ */
          user-select: none; /* Standard syntax */
        }

    </style>
    <body>
        <!--div id="splash" class="center" style="visibility: visible; font-family: Arial, Helvetica, sans-serif; color: rgb(255, 255, 255); height: 50%;"-->
        <div id="splash" class="center" style="visibility: visible; font-family: Arial, Helvetica, sans-serif; font-size: 12pt; color: rgb(255, 255, 255);">
            ...computing bitmaps...
        </div>
        <div id="heading1" align="center" style="background-color: rgb(48, 48, 48); color: rgb(208, 208, 208); visibility: hidden; position: absolute; top: 0px; right: 0px; left: 0px; font-family: Arial, Helvetica, sans-serif; font-size: 48px; font-weight: bold;">
            <heading1>
                E-Fun
            </heading1>
        </div>
        <div id="divContainer" style="position: absolute; top: 58px; bottom: 10px; left: 10px; right: 10px;">
        </div>
        <img id="i1" src="media/i1.svg" style="visibility: hidden; position: absolute; opacity: 1;">
        <img id="i2" src="media/i2.svg" style="visibility: hidden; position: absolute; opacity: 1;">
        <img id="i3" src="media/i3.svg" style="visibility: hidden; position: absolute; opacity: 1;">
        <!--script src="commonmark.min.js"></script-->
        <script src="orbital.js"></script>
        <script>
            function generateNumberCanvas (text) {
                var cnvim = document.createElement ("canvas");
                cnvim.width = 550;
                cnvim.height = 350;
                var ctxim = cnvim.getContext('2d');

                ctxim.fillStyle = "white";
                ctxim.fillRect(0, 0, cnvim.width, cnvim.height);

                ctxim.globalAlpha = 0.5;

                for (var i = 0; i < 1; i++) {
                    var rnd = (100 + Math.round (Math.random () * 50));
                    ctxim.fillStyle = "rgb(" + rnd + "," + rnd + "," + rnd + ")";
                    var x = Math.random () * 225;
                    var y = Math.random () * 175;
                    ctxim.fillRect(x, y, 550 - x - Math.random () * 225, 350 - y - Math.random () * 175);
                    
                    ctxim.beginPath();
                    var rnda = Math.random () * Math.PI * 1 / 3;
                    var rndr = 100 + Math.random () * 50;
                    ctxim.moveTo(225 + Math.cos (rnda) * rndr, 175 + Math.sin (rnda) * rndr);
                    rnda = Math.PI * 2 / 3 + Math.random () * Math.PI * 1 / 3;
                    rndr = 100 + Math.random () * 50;
                    ctxim.lineTo(225 + Math.cos (rnda) * rndr, 175 + Math.sin (rnda) * rndr);
                    rnda = Math.PI * 4 / 3 + Math.random () * Math.PI * 1 / 3;
                    rndr = 100 + Math.random () * 50;
                    ctxim.lineTo(225 + Math.cos (rnda) * rndr, 175 + Math.sin (rnda) * rndr);
                    ctxim.closePath ();
                    
                    rnd = (100 + Math.round (Math.random () * 50));
                    ctxim.fillStyle = "rgba(" + rnd + "," + rnd + "," + rnd + ", 128)";
                    ctxim.fill (); 

                    ctxim.beginPath();
                    ctxim.ellipse (
                        225 + Math.random () * 100,
                        175 + Math.random () * 80,
                        50 + Math.random () * 50,
                        50 + Math.random () * 50,
                        0,
                        0,
                        2 * Math.PI,
                        false
                    );
                    ctxim.closePath ();

                    rnd = (100 + Math.round (Math.random () * 50));
                    ctxim.fillStyle = "rgba(" + rnd + "," + rnd + "," + rnd + ", 128)";
                    ctxim.fill (); 
                }

                ctxim.globalAlpha = 1;

                var h = 225;
                var text1 = text
                ctxim.font = h + "px sans";
                ctxim.fillStyle = "black";
                ctxim.fillText(text, cnvim.width / 2 - ctxim.measureText(text1).width / 2, cnvim.height / 2 + h / 2 - h / 4.8);
                
                return cnvim
            }

            function generateCanvasScape (r, index) {
                if (!r) r = 0;
                if (!index) index = 0;
                
                var data = {
                    canvas: generateNumberCanvas (r + " - " + index),
                    children: []
                };
                
                if (r < 2)
                    for (var i = 0; i < 5; i++)
                        data.children.push (generateCanvasScape (r + 1, i));
                
                return data;
            }
            
            /*
            function toggleFullScreen() {
              var doc = window.document;
              var docEl = doc.documentElement;

              var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullscreen || docEl.msRequestFullscreen;
              var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

              if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
                requestFullScreen.call(docEl);
              }
              else {
                cancelFullScreen.call(doc);
              }
            }
            */

            function setSize () {
                i1.draggable = false;
                i1.ondragstart = function () {return false};
                i2.draggable = false;
                i2.ondragstart = function () {return false};
                i3.draggable = false;
                i3.ondragstart = function () {return false};
                
                var ratio = 1;// / 1.61803398875;
                
                var w = document.body.clientWidth;
                var h = document.body.clientHeight;
                
                if (w >= h) {
                    var m = (document.body.clientHeight - 58) / 950;
                    var ratioX = ratio;
                    var ratioY = 1;

                } else {
                    var m = document.body.clientWidth / 950;
                    var ratioX = 1;
                    var ratioY = ratio;

                }
                
                if (m > 0.7) m = 0.7;
                
                i1.style.width = m * 215 + "px";
                i2.style.width = m * 215 + "px";
                i3.style.width = m * 215 + "px";

                /*
                i1.style.transform = "";
                i2.style.transform = "";
                i3.style.transform = "";
                */

                i1.style.transform = " scale(" +
                  ratioX + ", " +
                  ratioY +
                  ")";
                i2.style.transform = " scale(" +
                  ratioX + ", " +
                  ratioY +
                  ")";
                i3.style.transform = " scale(" +
                  ratioX + ", " +
                  ratioY +
                  ")";

                if (w >= h) {
                    var gap = (h - i1.clientHeight - i2.clientHeight - i3.clientHeight - 58) / 4;

                    i1.style.top = 58 + gap + "px";
                    i1.style.left = 10 + "px";
                    i2.style.top = 58 + gap + i1.clientHeight + gap + "px";
                    i2.style.left = 10 + "px";
                    i3.style.top = 58 + gap + i1.clientHeight + gap + i2.clientHeight + gap + "px";
                    i3.style.left = 10 + "px";
                    
                    divContainer.style.left = 20 + i1.clientWidth + "px";
                    divContainer.style.top = "68px";
                } else {
                    var gap = (w - i1.clientWidth - i2.clientWidth - i3.clientWidth) / 4;
                    
                    i1.style.left = gap + "px";
                    i1.style.top = 58 + 10 + "px";
                    i2.style.left = gap + i1.clientWidth + gap + "px";
                    i2.style.top = 58 + 10 + "px";
                    i3.style.left = gap + i1.clientWidth + gap + i2.clientWidth + gap + "px";
                    i3.style.top = 58 + 10 + "px";
                    
                    divContainer.style.left = "10px";
                    divContainer.style.top = (58 + 20 + i1.clientHeight) + "px";
                }
                
                var event1 = new CustomEvent('resize1', null);
                divContainer.dispatchEvent(event1);
            }
            
            var i1 = document.getElementById("i1");
            var i2 = document.getElementById("i2");
            var i3 = document.getElementById("i3");
            
            wonload = function () {
                document.getElementById("vis").onclick = (function () {
                    window.location.href = 'https://github.com/e-teoria/Orbiteque';
                })
                
                document.getElementById("vis").ontouchstart = document.getElementById("vis").onclick;
                
                /*document
                .querySelector("meta[name=viewport]")
                .setAttribute('content', 'initial-scale=0.5', 'maximum-scale=0.5', 'width=' + (document.documentElement.clientWidth * 2), 'height=' + (document.documentElement.clientHeight * 2));
                */
                document.getElementById("splash").style.visibility = "hidden";
                document.getElementById("heading1").style.visibility = "visible";
                document.getElementById("vis").style.visibility = "visible";
                i1.style.visibility = "visible";
                i2.style.visibility = "visible";
                i3.style.visibility = "visible";
                divContainer.style.visibility = "visible";

                setSize ();

                var resizeId;
                window.addEventListener('resize', function () {
                    /*document
                    .querySelector("meta[name=viewport]")
                    .setAttribute('content', 'user-scalable=no', 'width=' + (document.documentElement.clientWidth), 'height=' + (document.documentElement.clientHeight));
                    document.getElementById("splash").style.visibility = "visible";
                    */
                    //document.getElementById("splash").style.visibility = "visible";
                    document.getElementById("heading1").style.visibility = "hidden";
                    document.getElementById("vis").style.visibility = "hidden";
                    i1.style.visibility = "hidden";
                    i2.style.visibility = "hidden";
                    i3.style.visibility = "hidden";
                    divContainer.style.visibility = "hidden";
                    
                    clearTimeout(resizeId);
                    resizeId = setTimeout(function () {
                        //document.getElementById("splash").style.visibility = "hidden";
                        
                        document.getElementById("heading1").style.visibility = "visible";
                        document.getElementById("vis").style.visibility = "visible";
                        i1.style.visibility = "visible";
                        i2.style.visibility = "visible";
                        i3.style.visibility = "visible";
                        divContainer.style.visibility = "visible";

                        setSize ();
                    }, 500);
                });
            }

            function createCanvas (img) {
                var cnvim = document.createElement ("canvas");
                cnvim.width = img.width;
                cnvim.height = img.height;
                var ctxim = cnvim.getContext ('2d');

                ctxim.fillStyle = "white";
                ctxim.fillRect(0, 0, img.width, img.height);

                ctxim.drawImage (img, 0, 0);

                return cnvim
            }            
            
            
            var loader = function (data) {
                var images = [];

                (function loadImages (node) {
                    node.img = new Image ();
                    
                    node.img.crossOrigin = "anonymous";
                    
                    node.img.onload = function (e) {
                        node.canvas = createCanvas (node.img);
                    }
                    
                    node.img.src = node.image;
                    images.push (node.img);

                    if (node.children)
                        for (var i = 0; i < node.children.length; i++)
                            loadImages (node.children[i]);
                })(data);
                
                return images;
            };
            
            function loadContents () {
                var xhttp = new XMLHttpRequest ();
                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        data = JSON.parse (this.responseText);
                        
                        document.getElementById("heading1").innerHTML = data.title;
                        document.getElementsByTagName("TITLE")[0].text = data.title;
                        
                        var images = loader (data.data);
                        
                        var waitForImages = function () {
                            for (var i = 0; i < images.length; i++){
                                if (!images[i].complete) {
                                    setTimeout(waitForImages, 50);
                                    return;
                                }                 
                            }
                            Orbital (divContainer, data.data);
                            if (document.readyState === "complete" || document.readyState === "interactive") {
                                wonload();
                            } else {
                                window.addEventListener("load", function () {
                                    wonload ();
                                });
                            }
                        }
                        
                        waitForImages ();
                            
                        
                    }
                
                };
                xhttp.open("GET", "contents.json", true);
                xhttp.send();
            }
            
            var divContainer = document.getElementById ("divContainer")
            //Orbital(divContainer, generateCanvasScape ());
            
            loadContents ();
            
            
        </script>
        <!--svg id="fs" onclick="toggleFullScreen ()" style="position: absolute; top: 0; right: 0;"
           xmlns:dc="http://purl.org/dc/elements/1.1/"
           xmlns:cc="http://creativecommons.org/ns#"
           xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
           xmlns:svg="http://www.w3.org/2000/svg"
           xmlns="http://www.w3.org/2000/svg"
           id="svg8"
           version="1.1"
           viewBox="0 0 14.552083 14.552084"
           height="55"
           width="55">
          <defs
             id="defs2" />
          <metadata
             id="metadata5">
            <rdf:RDF>
              <cc:Work
                 rdf:about="">
                <dc:format>image/svg+xml</dc:format>
                <dc:type
                   rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                <dc:title></dc:title>
              </cc:Work>
            </rdf:RDF>
          </metadata>
          <g
             transform="translate(0,-282.4479)"
             id="layer1">
            <path
               id="path833"
               d="m 3.2248744,288.37355 v -2.70078 h 2.7007782"
               style="fill:none;stroke:rgb(255, 255, 255);stroke-width:0.52916667;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
            <path
               id="path835"
               d="m 8.6381733,285.67277 h 2.6890357 v 2.70078"
               style="fill:none;stroke:rgb(255, 255, 255);stroke-width:0.52916667;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
            <path
               id="path837"
               d="m 11.327209,291.07433 v 2.70078 H 8.6381733"
               style="fill:none;stroke:rgb(255, 255, 255);stroke-width:0.52916667;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
            <path
               id="path839"
               d="M 5.9256526,293.77511 H 3.2248744 v -2.70078"
               style="fill:none;stroke:rgb(255, 255, 255);stroke-width:0.52916667;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
          </g>
        </svg-->
        <a id="vis" class="exhover" style="visibility: hidden; position: absolute; bottom: 0px; right: 5px; clip-path: circle(40% at 50% 50%);">
            <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="" style="width:96px; height:96px; padding-top: 3px; padding-left: 4px; padding-right: 4px; padding-bottom: 0px;">
        </a>
    </body>
</html>
